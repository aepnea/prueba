<style type='text/css'>
</style>
<div style="width:100%; height:350px; position:relative; margin-top:90px;">
  <div id='map'></div>
</div>
<div style="width:100%; height:300px; position:relative;">
  <%= area_chart @data.group(:time).maximum(:ele), discrete: true%>
</div>
<script>
  $(document).on('turbolinks:load turbolinks:render ready', function() {
    mapboxgl.accessToken = 'pk.eyJ1Ijoibm9yZWxsYW5hIiwiYSI6ImNpbzR5emozNDAxcHJ2aWx6OHRoNHVzMWMifQ.NMjJ_fsTMlCCkzytqaV0LQ';
    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/outdoors-v9',
      center: [<%=@center.lon%>, <%=@center.lat%>],
      zoom: 12
    });



    map.on('load', function () {
      map.addSource("route", {
        "type": "geojson",
        "data": {
          "type": "Feature",
          "geometry": {
              "type": "LineString",
              "coordinates": [
                <%@data.each do |d|%>
                  [<%=d.lon%>, <%=d.lat%>],
                <%end%>
              ]
          }
        }
      });
      map.addControl(new mapboxgl.NavigationControl());

      map.addLayer({
        "id": "route",
        "type": "line",
        "source": "route",
        "layout": {
          "line-join": "round",
          "line-cap": "round"
        },
        "paint": {
          "line-color": "#fc4353",
          "line-width": 3
          }
      });
    });
  });
</script>
